
2019年 03月 08日 星期五 09:33:02 CST
　　说明：　the RTT uses the CMake build system
		     for configuring and building the library.
== github地址
     https://github.com/orocos-toolchain/rtt/tree/v2.9.0-rc1

== 安装包
     rtt-toolchain-2.9.zip (没有找到orocos-rtt-2.9.0-src.tar.bz2,应该是改名了)
　   unzip rtt*.zip
== 安装
     1. sudo apt-get install cmake
	      20.5M
	    cmake --version
     2. 添加 xenomai位置信息的 环境变量
	    XENOMAI_ROOT_DIR=/usr/xenomai
 		export XENOMAI_ROOT_DIR 
        执行source /etc/profile 
	 3. 进入rtt的源码目录(我的是 rtt-toolchain-2.9)
	 	mkdir build  ;; if you want to change the default configuration settings)
		cd rtt-toolchain-2.9.0/build  ;;
 		cmake .. -DOROCOS_TARGET=<target>			  ;;xenomai/gnulinux/lxrt/macosx/win32
		
			  	 [-DCMAKE_PREFIX_PATH=/opt/orocos]    ;;指定库的位置(如 Boost, TAO/ACE等)
				 									  
				 [-DCMAKE_INSTALL_PREFIX=/usr/local]  ;;指定 RTT 的安装位置
				 
				 [-DLINUX_SOURCE_DIR=/usr/src/linux]  ;;打了xenomai补丁的Linux kernel源码的位置
				 									  	(xenomai <2.2.0需要，现在应该不用了)
		ccmake ..
		  BUILD_STATIC    on											

	    make   ;; 将创建一个　liborocos-rtt-<target>.so

        error:
			fatal error: native/task.h: No such file or directory
			=> 查看文档 Migrating from Xenomai 2.x to 3.x

			undefined reference to `rt_mutex_inquire`
			    rt_mutex_release
				rt_mutex_acquire_timed
				rt_mutex_inquire
				rt_mutex_delete
				rt_sem_delete
				rt_sem_v
				rt_sem_p_timed
				rt_sem_create
				
				rt_sem_p  没有
				
				rt_task_set_priority
				rt_task_set_periodic
				rt_task_yield
				rt_task_delete
				rt_task_join
				rt_task_spawn
				rt_task_inquire
				rt_task_wait_period
				rt_timer_ns2ticks
				rt_task_self
				rt_task_same
				rt_task_shadow

				timespec_add
				cobalt_divrem_billion
				__cobalt_clock_gettime

				timespec_add

		  make docapi/docpdf/dochtml
		make install


== warning
   Could NOT find Xerces (missing: XERCES_C_LIBRARY_INCLUDE_DIR)
   => sudo apt-get install libxerces-c3-dev
   
   XENOMAI_INCLUDE_DIR=XENOMAI_INCLUDE_DIR-NOTFOUND
   XENOMAI_NATIVE_LIBRARY=XENOMAI_NATIVE-LIBRARY-NOTFOUND
   Cmake Error at config/LibFindMacros.cmake:74 (message)
     Required library XENOMAI NOT
   => export XENOMAI_ROOT_DIR=/usr/xenomai
   => export XENOMAI_INCLUDE_DIR=/usr/xenomai/include
   => export XENOMAI_NATIVE_LIBRARY=/uar/xenomai/lib
   
   Found XenomaiPosix in XENOMAI_POSIX_INCLUDE_DIR-NOTFOUND
   Optonal library XENOMAI_POSIX NOT FOUND.
   

cd ..
== Section 3, Detailed Configuration using CMake
     export CMAKE_INCLUDE_PATH=/usr/include;/boot/include
	 export CMAKE_LIBRARY_PATH=/usr/libs;/boost/lib
	 or
	 export CMAKE_PREFIX_PATH=/boost

== Migrating from Xenomai 2.x to 3.x
    rt_timer_read()

	./src/linux-headers-4.14.89-xenomai-3.0.10/include/xenomai/cobalt/kernel/intr.h
	RT_INTR

 	=> orocos
	    nano2ticks 临时修改
	    ticks2nano　临时修改
	    
        config/FindXenomai.cmake  ; native
	
	
	
	 
== Xenomai 2
     interrupt handled in userspace
       asynchronous notifications from kernelspace to userspace
	 
== Xenomai 3

== undefined reference to
     => 报错 编译文件
	   build/rtt/CMakeFiles/orocos-rtt-xenomai_dynamic.dir/build.make
	   　　#Object files for target orocos-rtt-xenomai_dynamic
	       
	 => 出错的 .o文件
	      Logger.cpp.o　
		  TaskContext.cpp.o
		  ExecutionEngine.cpp.o		  
			这个提示出的都是别的文件中的问题，有
			=>
				os/xenomai/fosi.h
				    rt_mutex_inquire
					rt_mutex_release
					rt_mutex_delete
						     create
				    rt_timer_ns2ticks
					         ticks2ns
							 
					rt_cond_broadcast
					rt_cond_delete
					rt_cond_create

					rt_sem_v
					rt_sem_inquire
					rt_sem_delete
					

				alchemy/mutex.h
				    rt_mutex_acquire_timed
					rt_mutex_acquire_timed
			    alchemy/cond.h
				    rt_cond_wait_timed


				alchemy/timer.h
					alchemy_clock
					clockobj_get_time		libcopperpalte.so
			    alchemy/sem.h
					rt_sem_p_timed
					
					
				copperplate/clockobj.h		libcobalt.so
				    __cobalt_clock_gettime
				    cobalt_divrem_billion
					timespec_add
		  =>os/tlsf		在 libalchemy.so 中都有定义
		    tlsf.c.o
			问题函数：
			  rt_mutex_create
					   acquire_timed
					   release
					   delete
		  =>os
		    Timer.cpp.o
            TimeService.cpp.o
			Thread.cpp.o
		  =>os/xenomai
	          fosi_internal.cpp.o
			  问题函数：
				rt_task_self
				    shadow
					same
				    wait_period
				    inquire	
				    spawn			W
				    yield
				    join
				    delete
				    set_periodic   W
				    set_priority
　			    rt_timer_ns2ticks	
			    rt_mutex_acquire_timed
				    release				
			  问题分析：
				fosi.h　这个头文件
				在 libalchemy.so 中都有定义
		  =>base
		      ChannelInterface.cpp.o
		  =>internal
		      ConnectionManager.cpp.o
		      SendHandleC.cpp.o
          =>types
			  TypeInfoRepository.cpp.o
	      =>plugin
			  PluginLoader.cpp.o
		  =>extras
		      SequentialActivity.cpp.o
			  FileDescriptorActivity.cpp.o               
			  TimerTHread.cpp.o
   

== CMake files 调用顺序
    rtt/CMakeLists.txt
		rtt/rtt/CMakeLists.txt
		    rtt/rtt/os/CMakeLists.txt
		        rtt/rtt/os/xenomai/CMakeLists.txt		  
    5 build/rtt/CMakeFiles/orocos-rtt-xenomai_dynamic.dir/build.make
